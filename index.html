<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ–∫—Å–µ–ª—å–Ω—ã–µ –í—Ä–∞—Ç–∞</title>
    <script src="https://unpkg.com/three@0.132.2/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }
        
        #game-container {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }
        
        #ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .health-bar {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 200px;
            height: 25px;
            background: rgba(255, 0, 0, 0.3);
            border-radius: 12px;
            border: 2px solid #ff5555;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }
        
        .health-fill {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #00ff00);
            transition: width 0.3s;
        }
        
        .health-text {
            position: absolute;
            top: 50px;
            left: 20px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .score-display {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #00ffea;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            text-align: right;
        }
        
        .weapon-display {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #ffaa00;
            min-width: 200px;
        }
        
        .weapon-name {
            font-size: 20px;
            color: #ffaa00;
            font-weight: bold;
            text-align: center;
        }
        
        .weapon-stats {
            display: flex;
            justify-content: space-between;
            font-size: 16px;
            margin-top: 5px;
        }
        
        .ability-display {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }
        
        .ability-icon {
            width: 60px;
            height: 60px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            border: 2px solid #00ff88;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }
        
        .army-count {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 32px;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 2px 10px #00ff88;
            text-align: right;
        }
        
        .army-text {
            font-size: 18px;
            color: white;
            margin-top: 5px;
        }
        
        .crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            pointer-events: none;
            z-index: 5;
        }
        
        .crosshair::before,
        .crosshair::after {
            content: '';
            position: absolute;
            background: #00ffea;
            box-shadow: 0 0 5px #00ffea, 0 0 10px #00ffea;
        }
        
        .crosshair::before {
            width: 24px;
            height: 4px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .crosshair::after {
            width: 4px;
            height: 24px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .crosshair-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: #00ffea;
            border-radius: 50%;
            box-shadow: 0 0 10px #00ffea;
        }
        
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            display: none;
        }
        
        .game-over h1 {
            color: #ff5555;
            font-size: 48px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .game-over p {
            font-size: 24px;
            margin: 10px 0;
            color: #00ffea;
        }
        
        .restart-btn {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 20px;
            background: linear-gradient(45deg, #ff5555, #ffaa00);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.3s;
            pointer-events: auto;
        }
        
        .restart-btn:hover {
            transform: scale(1.05);
        }
        
        .gate-notification {
            position: fixed;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px 30px;
            border-radius: 15px;
            border: 3px solid #00ff88;
            font-size: 28px;
            font-weight: bold;
            color: #00ff88;
            z-index: 50;
            text-align: center;
            display: none;
            min-width: 300px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.7);
        }
        
        .platform-indicator {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #0088ff;
            font-size: 18px;
            font-weight: bold;
            color: #0088ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .swipe-hint {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: #00ffea;
            font-size: 18px;
            text-align: center;
            display: none;
        }
        
        .mobile-controls {
            position: fixed;
            bottom: 100px;
            right: 100px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            display: none;
        }
        
        .mobile-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: white;
            pointer-events: auto;
        }
        
        @media (max-width: 768px) {
            .health-bar {
                top: 10px;
                left: 10px;
                width: 150px;
                height: 20px;
            }
            
            .health-text {
                top: 35px;
                left: 10px;
                font-size: 18px;
            }
            
            .score-display {
                top: 10px;
                right: 10px;
                font-size: 20px;
            }
            
            .weapon-display {
                bottom: 10px;
                left: 10px;
                padding: 10px;
                min-width: 150px;
            }
            
            .ability-display {
                top: 10px;
                gap: 8px;
            }
            
            .ability-icon {
                width: 45px;
                height: 45px;
                font-size: 22px;
            }
            
            .army-count {
                bottom: 10px;
                right: 10px;
                font-size: 24px;
            }
            
            .swipe-hint {
                display: block;
            }
            
            .mobile-controls {
                display: flex;
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes gateGlow {
            0% { box-shadow: 0 0 20px currentColor; }
            50% { box-shadow: 0 0 40px currentColor; }
            100% { box-shadow: 0 0 20px currentColor; }
        }
        
        @keyframes spawnAnimation {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .instructions {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 20px;
            border: 4px solid #00ffea;
            text-align: center;
            max-width: 600px;
            z-index: 20;
        }
        
        .instructions h2 {
            color: #00ffea;
            font-size: 36px;
            margin-bottom: 20px;
        }
        
        .instructions p {
            margin: 15px 0;
            font-size: 20px;
            line-height: 1.5;
        }
        
        .instructions ul {
            text-align: left;
            margin: 20px;
            font-size: 18px;
        }
        
        .start-btn {
            margin-top: 30px;
            padding: 15px 40px;
            font-size: 22px;
            background: linear-gradient(45deg, #0088ff, #00ff88);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            pointer-events: auto;
            transition: transform 0.3s;
        }
        
        .start-btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    
    <div id="ui-overlay">
        <div class="health-text" id="health-text">100/100</div>
        <div class="health-bar">
            <div class="health-fill" id="health-fill"></div>
        </div>
        
        <div class="score-display">
            –°—á–µ—Ç: <span id="score">0</span>
        </div>
        
        <div class="ability-display">
            <div class="ability-icon" id="ability-x2" title="x2 –ú–Ω–æ–∂–∏—Ç–µ–ª—å">x2</div>
            <div class="ability-icon" id="ability-x3" title="x3 –ú–Ω–æ–∂–∏—Ç–µ–ª—å">x3</div>
            <div class="ability-icon" id="ability-x5" title="x5 –ú–Ω–æ–∂–∏—Ç–µ–ª—å">x5</div>
        </div>
        
        <div class="weapon-display">
            <div class="weapon-name" id="weapon-name">–í–û–ö–°–ï–õ–¨–ù–´–ô –ú–ï–ß</div>
            <div class="weapon-stats">
                <span>–£—Ä–æ–Ω: <span id="weapon-damage">10</span></span>
                <span>–°–∫–æ—Ä–æ—Å—Ç—å: <span id="weapon-speed">1.0</span></span>
            </div>
        </div>
        
        <div class="army-count">
            <span id="army-count">1</span>
            <div class="army-text">–í–û–ò–ù–û–í</div>
        </div>
        
        <div class="platform-indicator">
            <span>–í—Ä–∞—Ç–∞: </span>
            <span id="current-gate">+1</span>
        </div>
        
        <div class="crosshair">
            <div class="crosshair-dot"></div>
        </div>
        
        <div class="swipe-hint" id="swipe-hint">
            –°–º–∞—Ö–∏–≤–∞–π—Ç–µ –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤—Ä–∞—Ç
        </div>
        
        <div class="mobile-controls">
            <button class="mobile-btn" id="btn-left">‚Üê</button>
            <button class="mobile-btn" id="btn-right">‚Üí</button>
        </div>
        
        <div class="instructions" id="instructions">
            <h2>–í–û–ö–°–ï–õ–¨–ù–´–ï –í–†–ê–¢–ê</h2>
            <p>‚öîÔ∏è –°–æ–±–∏—Ä–∞–π—Ç–µ –∞—Ä–º–∏—é –≤–æ–∫—Å–µ–ª—å–Ω—ã—Ö –≤–æ–∏–Ω–æ–≤</p>
            <p>üéØ –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ —á–µ—Ä–µ–∑ –º–∞–≥–∏—á–µ—Å–∫–∏–µ –≤—Ä–∞—Ç–∞</p>
            <p>üî¥ –ö—Ä–∞—Å–Ω—ã–µ –≤—Ä–∞—Ç–∞ - –æ–ø–∞—Å–Ω–æ—Å—Ç—å</p>
            <p>üü¢ –ó–µ–ª–µ–Ω—ã–µ –≤—Ä–∞—Ç–∞ - —É–º–Ω–æ–∂–µ–Ω–∏–µ –∞—Ä–º–∏–∏</p>
            <p>üîµ –°–∏–Ω–∏–µ –≤—Ä–∞—Ç–∞ - —É–ª—É—á—à–µ–Ω–∏–µ –æ—Ä—É–∂–∏—è</p>
            <p>üêâ –°—Ä–∞–∂–∞–π—Ç–µ—Å—å —Å –±–æ—Å—Å–∞–º–∏</p>
            <ul>
                <li>–ú—ã—à—å/—Ç–∞—á - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</li>
                <li>A/D –∏–ª–∏ —Å–≤–∞–π–ø - –≤—ã–±–æ—Ä –≤—Ä–∞—Ç</li>
                <li>–ö–ª–∏–∫/—Ç–∞–ø - –∞—Ç–∞–∫–∞</li>
                <li>–ü—Ä–æ–±–µ–ª - –æ—Å–æ–±–æ–µ —É–º–µ–Ω–∏–µ</li>
            </ul>
            <button class="start-btn" id="start-btn">–ù–ê–ß–ê–¢–¨ –ü–£–¢–ï–®–ï–°–¢–í–ò–ï</button>
        </div>
    </div>
    
    <div class="game-over" id="game-over">
        <h1>–ü–£–¢–ï–®–ï–°–¢–í–ò–ï –ó–ê–ö–û–ù–ß–ï–ù–û</h1>
        <p>–†–∞–∑–º–µ—Ä –∞—Ä–º–∏–∏: <span id="final-army">0</span> –≤–æ–∏–Ω–æ–≤</p>
        <p>–°—á–µ—Ç: <span id="final-score">0</span></p>
        <p>–ü—Ä–æ–π–¥–µ–Ω–æ –≤—Ä–∞—Ç: <span id="gates-passed">0</span></p>
        <p>–†–µ–∫–æ—Ä–¥: <span id="high-score">0</span></p>
        <button class="restart-btn" id="restart-btn">–ù–û–í–û–ï –ü–£–¢–ï–®–ï–°–¢–í–ò–ï</button>
    </div>
    
    <div class="gate-notification" id="gate-notification">
        –ê–†–ú–ò–Ø –£–ú–ù–û–ñ–ï–ù–ê x2!
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã
        const GAME_CONFIG = {
            // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
            platforms: 3,
            platformPositions: [-6, 0, 6],
            platformWidth: 3,
            platformDepth: 20,
            
            // –í—Ä–∞—Ç–∞
            gateTypes: {
                positive: ['x2', 'x3', 'x5', '+10', '+20', '+50'],
                negative: ['√∑2', '√∑3', '-10', '-20', '-50', '–ë–û–°–°'],
                weapon: ['‚öîÔ∏è+', 'üî•+', '‚ö°+', '‚ùÑÔ∏è+']
            },
            
            // –ò–≥—Ä–æ–∫
            initialHealth: 100,
            initialArmy: 1,
            
            // –û—Ä—É–∂–∏–µ
            weapons: [
                { name: '–í–û–ö–°–ï–õ–¨–ù–´–ô –ú–ï–ß', damage: 10, speed: 1.0, color: 0xaaaaaa },
                { name: '–õ–ê–ó–ï–†–ù–ê–Ø –ü–£–®–ö–ê', damage: 25, speed: 0.8, color: 0x00ffff },
                { name: '–û–ì–ù–ï–ù–ù–´–ô –ú–û–õ–û–¢', damage: 40, speed: 0.6, color: 0xff5500 },
                { name: '–õ–ï–î–Ø–ù–û–ô –ö–õ–ò–ù–û–ö', damage: 30, speed: 1.2, color: 0x0088ff }
            ],
            
            // –ë–æ—Å—Å—ã
            bosses: ['–î–†–ê–ö–û–ù', '–ì–ò–ì–ê–ù–¢–°–ö–ò–ô –ü–ê–£–ö', '–ö–û–†–û–õ–¨ –ì–û–ë–õ–ò–ù–û–í'],
            
            // –ë–∞–ª–∞–Ω—Å
            difficultyIncrement: 0.05,
            maxGates: 8
        };

        // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        const gameState = {
            score: 0,
            health: GAME_CONFIG.initialHealth,
            maxHealth: GAME_CONFIG.initialHealth,
            army: GAME_CONFIG.initialArmy,
            currentPlatform: 1,
            weaponIndex: 0,
            gates: [],
            activeGates: [],
            boss: null,
            particles: [],
            gameOver: false,
            gameStarted: false,
            gatesPassed: 0,
            multiplier: 1,
            difficulty: 1.0
        };

        // –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã
        let scene, camera, renderer;
        let platforms = [];
        let gates = [];
        let boss = null;
        let weapon = null;
        let playerArmy = [];
        let particles = [];
        let isAttacking = false;
        let currentTarget = null;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã UI
        const healthText = document.getElementById('health-text');
        const healthFill = document.getElementById('health-fill');
        const scoreElement = document.getElementById('score');
        const weaponName = document.getElementById('weapon-name');
        const weaponDamage = document.getElementById('weapon-damage');
        const weaponSpeed = document.getElementById('weapon-speed');
        const armyCount = document.getElementById('army-count');
        const currentGate = document.getElementById('current-gate');
        const gameOverScreen = document.getElementById('game-over');
        const finalArmy = document.getElementById('final-army');
        const finalScore = document.getElementById('final-score');
        const gatesPassed = document.getElementById('gates-passed');
        const highScore = document.getElementById('high-score');
        const restartBtn = document.getElementById('restart-btn');
        const gateNotification = document.getElementById('gate-notification');
        const instructions = document.getElementById('instructions');
        const startBtn = document.getElementById('start-btn');
        const swipeHint = document.getElementById('swipe-hint');
        const btnLeft = document.getElementById('btn-left');
        const btnRight = document.getElementById('btn-right');

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫—É–±–∏–∫–∞ (–≤–æ–∫—Å–µ–ª—è)
        function createVoxel(color, size = 0.1) {
            const geometry = new THREE.BoxGeometry(size, size, size);
            const material = new THREE.MeshPhongMaterial({ 
                color: color,
                flatShading: true
            });
            return new THREE.Mesh(geometry, material);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–π –≤–æ–∫—Å–µ–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏
        function createVoxelModel(baseColor, voxelSize = 0.15) {
            const group = new THREE.Group();
            
            // –û—Å–Ω–æ–≤–∞ –º–æ–¥–µ–ª–∏
            for (let x = 0; x < 3; x++) {
                for (let y = 0; y < 4; y++) {
                    for (let z = 0; z < 2; z++) {
                        const voxel = createVoxel(baseColor, voxelSize);
                        voxel.position.set(
                            (x - 1) * voxelSize * 1.2,
                            y * voxelSize * 1.2,
                            (z - 0.5) * voxelSize * 1.2
                        );
                        group.add(voxel);
                    }
                }
            }
            
            return group;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a1a);
            scene.fog = new THREE.Fog(0x0a0a1a, 10, 100);
            
            // –ö–∞–º–µ—Ä–∞
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 15);
            camera.lookAt(0, 0, 0);
            
            // –†–µ–Ω–¥–µ—Ä–µ—Ä
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('game-container').appendChild(renderer.domElement);
            
            // –û—Å–≤–µ—â–µ–Ω–∏–µ
            const ambien
